#!/bin/bash

# This script can be called from anywhere.
. "$MYPATH"/helper/detect
. "$MYPATH"/helper/qepcad

REALGEOM=realgeom/build/install/realgeom/bin/realgeom
test -x "$MYPATH"/$REALGEOM
echo -n "Starting local RealGeom server on port 8765..."
if [ "$OS_VARIANT" = "Mac" ]; then
 echo "#!/bin/bash
  export JAVA_HOME="$JAVA_HOME"
  export qe="$qe"
  export PATH="$PATH"
  cd "$MYPATH"
  cd realgeom
  ./gradlew run --args=\"-s\"" > start-realgeom.command
 chmod 755 start-realgeom.command
 open start-realgeom.command
 sleep 2
 REALGEOM_PID=`pgrep -n bash`
else
 $TERMINAL -e "cd \"$MYPATH\"; cd realgeom; ./gradlew run --args=\"-s\"" 2>/dev/null &
 export REALGEOM_PID=$!
 fi
while ! nc -z localhost 8765 && kill -0 $REALGEOM_PID ; do sleep 1; echo -n "."; done
nc -z localhost 8765 || echo "No realgeom server can be found, expect problems with RealGeomWS"
echo
