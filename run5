#!/bin/bash -x

# This script can be called from anywhere.
MYBASENAME=`perl -MCwd -e 'print Cwd::abs_path shift' "$0"`
MYPATH=`dirname "$MYBASENAME"`
. "$MYPATH"/helper/detect

BINDIR=fork/geogebra/desktop/build/install/desktop/bin
test -r "$MYPATH"/$BINDIR/desktop

if [ "$OS_VARIANT" = Mac ]; then
 export JAVA_HOME=`perl -MCwd -e 'print Cwd::abs_path shift' buildtools/jbrsdk/Contents/Home`
else
 if [ "$OS_VARIANT" != Raspbian ]; then
  export JAVA_HOME=`perl -MCwd -e 'print Cwd::abs_path shift' buildtools/jbr`
  fi
 fi

export MYPATH
. "$MYPATH"/helper/start-realgeom

echo -n "Launching GeoGebra..."
if [ "$MATHEMATICA" = "" ] ; then
 CAS=qepcad
else
 CAS=mathematica
 fi
$MYPATH/$BINDIR/desktop --realgeomws=remoteurl:http\\://localhost\\:8765,cas:$CAS "$@"

echo "GeoGebra session ended."

echo "Stopping RealGeom session..."

kill_descendant_processes $REALGEOM_PID
kill_descendant_processes $$

